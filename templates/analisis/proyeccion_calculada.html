{% extends 'dashboard/base.html' %}
{% load static %}

{% block title %}Calcular Proyecci贸n - {{ empresa.nombre }}{% endblock %}

{% block content %}
<div class="content-header">
    <div class="content-title">
        <h2> Calcular Proyecci贸n Autom谩tica</h2>
        <p>{{ empresa.nombre }} - Sector: {{ empresa.sector.nombre }}</p>
    </div>
</div>

<div class="card" style="margin-top: 2rem; max-width: 800px;">
    <div class="card-content">
        <h3 style="margin: 0 0 1rem 0; color: #111827;">Proyecci贸n desde Datos del Sistema</h3>
        
        <div class="info-note" style="margin-bottom: 1.5rem;">
            <strong>癸 C贸mo funciona:</strong>
            <ul style="margin: 0.5rem 0 0 1.5rem; padding: 0;">
                <li>El sistema buscar谩 los datos hist贸ricos de ventas de <strong>{{ empresa.nombre }}</strong></li>
                <li>Extraer谩 los valores de las columnas <strong>Mes</strong> y <strong>Venta</strong></li>
                <li>Calcular谩 autom谩ticamente las proyecciones usando 3 m茅todos matem谩ticos</li>
                <li>Generar谩 un gr谩fico interactivo con los resultados</li>
            </ul>
        </div>

        <div class="warning-note" style="background: #fef3c7; border-left: 4px solid #f59e0b; padding: 1rem; border-radius: 6px; margin-bottom: 1.5rem;">
            <strong>锔 Importante:</strong>
            <p style="margin: 0.5rem 0 0 0; color: #92400e;">
                Esta funcionalidad requiere que existan datos hist贸ricos de ventas en el sistema.
                Si no hay datos disponibles, use la opci贸n de "Subir Archivo Excel".
            </p>
        </div>

        <div style="background: #f9fafb; padding: 1.5rem; border-radius: 8px; margin-bottom: 1.5rem;">
            <h4 style="margin: 0 0 1rem 0; color: #374151; font-size: 1rem;">
                 M茅todos de C谩lculo
            </h4>
            <div style="display: grid; gap: 1rem;">
                <div style="display: flex; align-items: start; gap: 0.75rem;">
                    <div style="flex-shrink: 0; width: 8px; height: 8px; border-radius: 50%; background: #3b82f6; margin-top: 0.5rem;"></div>
                    <div>
                        <strong style="color: #1e40af;">Valor Incremental</strong>
                        <p style="margin: 0.25rem 0 0 0; color: #6b7280; font-size: 0.875rem;">
                            Calcula la tendencia basada en incrementos constantes
                        </p>
                    </div>
                </div>
                <div style="display: flex; align-items: start; gap: 0.75rem;">
                    <div style="flex-shrink: 0; width: 8px; height: 8px; border-radius: 50%; background: #10b981; margin-top: 0.5rem;"></div>
                    <div>
                        <strong style="color: #065f46;">Valor Absoluto</strong>
                        <p style="margin: 0.25rem 0 0 0; color: #6b7280; font-size: 0.875rem;">
                            Proyecta usando valores absolutos de variaci贸n
                        </p>
                    </div>
                </div>
                <div style="display: flex; align-items: start; gap: 0.75rem;">
                    <div style="flex-shrink: 0; width: 8px; height: 8px; border-radius: 50%; background: #f59e0b; margin-top: 0.5rem;"></div>
                    <div>
                        <strong style="color: #92400e;">M铆nimos Cuadrados</strong>
                        <p style="margin: 0.25rem 0 0 0; color: #6b7280; font-size: 0.875rem;">
                            Aplica regresi贸n lineal para proyecci贸n 贸ptima
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <form method="post" style="margin-top: 2rem;">
            {% csrf_token %}
            
            <div style="background: #eff6ff; border: 1px solid #bfdbfe; padding: 1rem; border-radius: 6px; margin-bottom: 1.5rem;">
                <p style="margin: 0; color: #1e40af; font-size: 0.875rem;">
                    <strong> Origen de Datos:</strong><br>
                    El sistema buscar谩 en la tabla de ventas mensuales los registros asociados a 
                    <strong>{{ empresa.nombre }}</strong> y extraer谩 los valores de las columnas 
                    <strong>Mes</strong> y <strong>Venta</strong> para realizar los c谩lculos.
                </p>
            </div>

            <div class="form-actions" style="display: flex; gap: 1rem; justify-content: space-between;">
                <a href="{% url 'analisis:proyeccion_metodos' empresa.pk %}" class="btn btn-secondary">
                    <svg class="btn-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" width="16" height="16">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
                    </svg>
                    <span>Cancelar</span>
                </a>
                
                <button type="submit" class="btn btn-primary">
                    <svg class="btn-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" width="16" height="16">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                              d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"></path>
                    </svg>
                    <span>Calcular Proyecci贸n</span>
                </button>
            </div>
        </form>
    </div>
</div>

<div class="info-note" style="margin-top: 2rem;">
    <strong> Nota T茅cnica:</strong>
    <p style="margin: 0.5rem 0 0 0;">
        Esta funcionalidad est谩 preparada para trabajar con una tabla de ventas hist贸ricas que ser谩 
        definida posteriormente. La estructura esperada incluye:
    </p>
    <ul style="margin: 0.5rem 0 0 1.5rem; padding: 0;">
        <li><strong>Campo Mes/Per铆odo:</strong> Fecha o nombre del per铆odo de venta</li>
        <li><strong>Campo Venta/Valor:</strong> Monto de las ventas del per铆odo</li>
        <li><strong>Relaci贸n con Empresa:</strong> Vinculaci贸n a la empresa correspondiente</li>
    </ul>
</div>
{% endblock %}
